!function(e){function t(s){if(o[s])return o[s].exports;var i=o[s]={exports:{},id:s,loaded:!1};return e[s].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";o(3),o(7),window.SelectorHelper=function(){function e(e){var t=e.features,o="";return t.forEach(function(e){e.selected&&(o+=e.name)}),""===o?e.tag:o}function t(e,t){var o="",s=null;return e.forEach(function(e,i){if(!(t>=0&&i>t))if(e.invalid)s=null;else if(e.selected){s&&(o+=" >");var n="";e.features.forEach(function(e){e.selected&&(n+=e.pattern)}),""===n&&(n="*"),o+=" "+n,s=e}else s=null}),""===o&&(o="*"),o.trim()}function o(e){$("#tab-web iframe").get(0).contentWindow.postMessage({type:"heightlight",css_selector:t(e)},"*")}function s(t){n.find(".element").remove();var s=[];$.each(t,function(i,n){var a=$("<span>").addClass("element").data("info",n);$('<span class="element-name">').text(n.name).appendTo(a),n.selected&&a.addClass("selected"),n.invalid&&a.addClass("invalid");var r=$("<ul>");$.each(n.features,function(s,i){var a=$("<li>").text(i.name).data("feature",i);i.selected&&a.addClass("selected"),a.appendTo(r),a.on("click",function(s){s.stopPropagation();var i=$(this),a=i.data("feature");a.selected?(a.selected=!1,i.removeClass("selected")):(a.selected=!0,i.addClass("selected"));var r=i.parents(".element");n.selected||(n.selected=!0,r.addClass("selected")),r.find(".element-name").text(e(n)),o(t)})}),r.appendTo(a),a.on("mouseover",function(e){var o=[];$.each(t,function(e,t){if(o.push(t.xpath),t===n)return!1}),$("#tab-web iframe")[0].contentWindow.postMessage({type:"overlay",xpath:"/"+o.join("/")},"*")}),a.on("click",function(s){s.stopPropagation();var i=$(this),n=i.data("info");n.selected?(n.selected=!1,i.removeClass("selected")):(n.selected=!0,i.addClass("selected")),i.find(".element-name").text(e(i.data("info"))),o(t)}),s.push(a)}),n.prepend(s),i(),o(t)}function i(){for(;n[0].scrollWidth>n.width();){var e=n.find(".element:visible:first");if(0==e.length)return;e.addClass("invalid").data("info").invalid=!0}}var n=$("#css-selector-helper"),a=null,r=$("#tab-web");return{init:function(){var e=this;e.clear(),window.addEventListener("message",function(e){"selector_helper_click"==e.data.type&&(console.log(e.data.path),s(e.data.path),a=e.data.path)}),$("#J-enable-css-selector-helper").on("click",function(){e.clear(),$("#tab-web iframe")[0].contentWindow.postMessage({type:"enable_css_selector_helper",src:location.protocol+"//"+location.host+"/static/css_selector_helper.min.js"},"*"),e.enable()}),$("#task-panel").on("scroll",function(e){n.is(":visible")&&($("#debug-tabs").position().top<0?(n.addClass("fixed"),r.addClass("fixed")):(n.removeClass("fixed"),r.removeClass("fixed")))});var o=n.find(".copy-selector-input");o.on("focus",function(e){$(this).select()}),n.find(".copy-selector").on("click",function(e){a&&(o.is(":visible")?(o.hide(),n.find(".element").show()):(n.find(".element").hide(),o.val(t(a)).show()))}),n.find(".add-to-editor").on("click",function(e){Debugger.python_editor_replace_selection(t(a))})},clear:function(){a=null,n.hide(),n.removeClass("fixed"),r.removeClass("fixed"),n.find(".element").remove()},enable:function(){n.show(),n.find(".copy-selector-input").hide(),$("#debug-tabs").position().top<0?(n.addClass("fixed"),r.addClass("fixed")):(n.removeClass("fixed"),r.removeClass("fixed"))}}}(),window.Debugger=function(){function e(e){return t.text(e).html()}var t=$("<div>"),o=0;return window.addEventListener("message",function(e){var t=60;"resize"==e.data.type&&e.data.height>o&&e.data.height-o!=t&&(o=e.data.height,$("#tab-web iframe").height(e.data.height+t))}),{init:function(){this.splitter=$(".debug-panel:not(:first)").splitter().data("splitter").trigger("init").on("resize-start",function(){$("#left-area .overlay").show()}).on("resize-end",function(){$("#left-area .overlay").hide()}),CodeMirror.keyMap.basic.Tab="indentMore",this.init_python_editor($("#python-editor")),this.init_task_editor($("#task-editor")),this.bind_debug_tabs(),this.bind_run(),this.bind_save(),this.bind_others(),SelectorHelper.init()},not_saved:!1,init_python_editor:function(e){var t=this;this.python_editor_elem=e;var o=this.python_editor=CodeMirror(e[0],{value:script_content,mode:"python",lineNumbers:!0,indentUnit:4,lineWrapping:!0,styleActiveLine:!0,autofocus:!0});o.on("focus",function(){e.addClass("focus")}),o.on("blur",function(){e.removeClass("focus")}),o.on("change",function(){t.not_saved=!0}),window.addEventListener("beforeunload",function(e){if(t.not_saved){var o="You have not saved changes.";return(e||window.event).returnValue=o,o}})},python_editor_replace_selection:function(e){this.python_editor.getDoc().replaceSelection(e)},auto_format:function(e){var t=e.getCursor(!0);CodeMirror.commands.selectAll(e),e.autoFormatRange(e.getCursor(!0),e.getCursor(!1)),e.setCursor(t)},format_string:function(e,t){var o=document.createElement("div"),s=CodeMirror(o,{value:e,mode:t});return this.auto_format(s),s.getDoc().getValue()},init_task_editor:function(e){var t=this.task_editor=CodeMirror(e[0],{value:task_content,mode:"application/json",indentUnit:2,lineWrapping:!0,styleActiveLine:!0,lint:!0});this.auto_format(t),t.getDoc().clearHistory(),t.on("focus",function(){e.addClass("focus")}),t.on("blur",function(){e.removeClass("focus")})},bind_debug_tabs:function(){var t=this;$("#tab-control > li[data-id]").on("click",function(){$("#tab-control > li[data-id]").removeClass("active");var e=$(this).addClass("active").data("id");$("#debug-tabs .tab").hide(),$("#debug-tabs #"+e).show()}),$("#tab-control li[data-id=tab-html]").on("click",function(){if(!$("#tab-html").data("format")){var o="";CodeMirror.runMode(t.format_string($("#tab-html pre").text(),"text/html"),"text/html",function(t,s){o+=s?'<span class="cm-'+s+'">'+e(t)+"</span>":e(t)}),$("#tab-html pre").html(o),$("#tab-html").data("format",!0)}})},bind_run:function(){var e=this;$("#run-task-btn").on("click",function(){e.run()}),$("#undo-btn").on("click",function(t){e.task_editor.execCommand("undo")}),$("#redo-btn").on("click",function(t){e.task_editor.execCommand("redo")})},bind_save:function(){var e=this;$("#save-task-btn").on("click",function(){var t=e.python_editor.getDoc().getValue();$("#right-area .overlay").show(),$.ajax({type:"POST",url:location.pathname+"/save",data:{script:t},success:function(t){console.log(t),e.python_log(""),e.python_log("saved!"),e.not_saved=!1,$("#right-area .overlay").hide()},error:function(t,o,s){console.log(t,o,s),e.python_log("save error!\n"+t.responseText),$("#right-area .overlay").hide()}})})},bind_follows:function(){var e=this;$(".newtask").on("click",function(){if($(this).next().hasClass("task-show"))return void $(this).next().remove();var e=$(this).after('<div class="task-show"><pre class="cm-s-default"></pre></div>').data("task");e=JSON.stringify(window.newtasks[e],null,"  "),CodeMirror.runMode(e,"application/json",$(this).next().find("pre")[0])}),$(".newtask .task-run").on("click",function(t){t.preventDefault(),t.stopPropagation();var o=$(this).parents(".newtask").data("task"),s=window.newtasks[o];e.task_editor.setValue(JSON.stringify(s,null,"  ")),e.task_updated(s),e.run()})},task_updated:function(e){$("#history-wrap").hide(),e.project&&e.taskid&&$.ajax({url:"/task/"+e.project+":"+e.taskid+".json",success:function(t){t.code||t.error||($("#history-link").attr("href","/task/"+e.project+":"+e.taskid).text("status: "+t.status_string),$("#history-wrap").show())}})},bind_others:function(){var e=this;$("#python-log-show").on("click",function(){$("#python-log pre").is(":visible")?($("#python-log pre").hide(),$(this).height(8)):($("#python-log pre").show(),$(this).height(0))}),$(".webdav-btn").on("click",function(){e.toggle_webdav_mode(this)})},render_html:function(e,t){var o=arguments.length<=2||void 0===arguments[2]||arguments[2],s=arguments.length<=3||void 0===arguments[3]||arguments[3],i=!(arguments.length<=4||void 0===arguments[4])&&arguments[4],n=arguments.length<=5||void 0===arguments[5]||arguments[5];void 0===e&&(e="");var a=(new DOMParser).parseFromString(e,"text/html");if($(a).find("base").remove(),$(a).find("head").prepend("<base>"),$(a).find("base").attr("href",t),o&&$(a).find("script").attr("type","text/plain"),s){var r=a.createElement("script");r.src=location.protocol+"//"+location.host+"/helper.js",a.body.appendChild(r)}if(i){var l=a.createElement("script");l.src=location.protocol+"//"+location.host+"/static/css_selector_helper.min.js",a.body.appendChild(l)}return n&&$(a).find("iframe[src]").each(function(e,t){t=$(t),t.attr("__src",t.attr("src")),t.attr("src",encodeURI("data:text/html;,<h1>iframe blocked</h1>"))}),a.documentElement.innerHTML},run:function(){var e=this.python_editor.getDoc().getValue(),t=this.task_editor.getDoc().getValue(),o=this;SelectorHelper.clear(),$("#tab-web .iframe-box").html(""),$("#tab-html pre").html(""),$("#tab-follows").html(""),$("#tab-control li[data-id=tab-follows] .num").hide(),$("#python-log").hide(),$("#left-area .overlay").show(),$.ajax({type:"POST",url:location.pathname+"/run",data:{webdav_mode:o.webdav_mode,script:o.webdav_mode?"":e,task:t},success:function(e){console.log(e),$("#left-area .overlay").hide(),$("#tab-web .iframe-box").html('<iframe sandbox="allow-same-origin allow-scripts" height="50%"></iframe>');var t=$("#tab-web iframe")[0],s=e.fetch_result.headers&&e.fetch_result.headers["Content-Type"]&&e.fetch_result.headers["Content-Type"]||"text/plain";if($("#tab-html pre").text(e.fetch_result.content),$("#tab-html").data("format",!0),0==s.indexOf("application/json"))try{var i=JSON.parse(e.fetch_result.content);i=JSON.stringify(i,null,"  "),i="<html><pre>"+i+"</pre></html>",t.srcdoc=o.render_html(i,e.fetch_result.url,!0,!0,!1)}catch(n){t.srcdoc="data:,Content-Type:"+s+" parse error."}else 0==s.indexOf("text/html")?(t.srcdoc=o.render_html(e.fetch_result.content,e.fetch_result.url,!0,!0,!1),$("#tab-html").data("format",!1)):0==s.indexOf("text")?t.srcdoc="data:"+s+","+e.fetch_result.content:e.fetch_result.dataurl?t.srcdoc=e.fetch_result.dataurl:t.srcdoc="data:,Content-Type:"+s;$("#tab-follows").html("");var a=$("#tab-control li[data-id=tab-follows] .num"),r='<div class="newtask" data-task="__task__"><span class="task-callback">__callback__</span> &gt; <span class="task-url">__url__</span><div class="task-run"><i class="fa fa-play"></i></div><div class="task-more"> <i class="fa fa-ellipsis-h"></i> </div></div>';if(e.follows.length>0){a.text(e.follows.length).show();var l="";window.newtasks={},$.each(e.follows,function(e,t){var o=t.process;o=o&&o.callback||"__call__";var s=r.replace("__callback__",o);s=s.replace("__url__",t.url||'<span class="error">no_url!</span>'),l+=s.replace("__task__",e),window.newtasks[e]=t}),$("#tab-follows").append(l),o.bind_follows()}else a.hide();if($("#tab-messages pre").html(""),e.messages.length>0){$("#tab-control li[data-id=tab-messages] .num").text(e.messages.length).show();var c=JSON.stringify(e.messages,null,"  ");CodeMirror.runMode(c,"application/json",$("#tab-messages pre")[0]),$("#tab-messages")[0]}else $("#tab-control li[data-id=tab-messages] .num").hide();$("#tab-control li.active").click(),o.python_log(e.logs)},error:function(e,t,s){console.log(e,t,s),o.python_log("error: "+t),$("#left-area .overlay").hide()}})},python_log:function(e){e?($("#python-log pre").text(e),$("#python-log pre, #python-log").show(),$("#python-log-show").height(0)):$("#python-log pre, #python-log").hide()},webdav_mode:!1,toggle_webdav_mode:function(e){if(this.webdav_mode){var t=this;$.ajax({type:"GET",url:location.pathname+"/get",success:function(o){t.splitter.trigger("init"),t.python_editor_elem.show(),t.python_editor.setValue(o.script),t.not_saved=!1,$(e).removeClass("active"),t.webdav_mode=!t.webdav_mode},error:function(){alert("Loading script from database error. Script may out-of-date."),t.python_editor_elem.show(),t.splitter.trigger("init"),$(e).removeClass("active"),t.webdav_mode=!t.webdav_mode}})}else{if(this.not_saved){if(!confirm("You have not saved changes. Ignore changes and switch to WebDav mode."))return;this.not_saved=!1}this.python_editor_elem.hide(),this.splitter.trigger("fullsize","prev"),$(e).addClass("active"),this.webdav_mode=!this.webdav_mode}}}}(),Debugger.init()},,,function(e,t){},,,,function(e,t){"use strict";$.fn.splitter=function(e){var t=$(document),o=$('<div class="block"></div>'),s=$("body"),i=JSON.parse(localStorage.getItem("splitterSettings")||"[]");return this.each(function(){function n(e){"y"===h&&(e-=m);var o=e-g[h].currentPos,s=100/g[h].size*o,a=(e-b[h])*g[h].multiplier,l=u[g[h].sizeProp](),d=r[g[h].sizeProp]();if("y"===h&&(s=100-s),l<100&&a<0);else if(d<100&&a>0);else{r.css(g[h].cssProp,s+"%"),u.css(g[h].otherCssProp,100-s+"%");var f={};f[g[h].cssProp]=s+"%",p.css(f),b[h]=e,i[c]=b,localStorage.setItem("splitterSettings",JSON.stringify(i)),n.timer&&clearTimeout(n.timer),n.timer=setTimeout(function(){t.trigger("sizeeditors")},120)}}function a(){u="x"===h?p.prevAll(":visible:first"):p.nextAll(":visible:first")}var r=$(this),l=$(this),c=$.fn.splitter.guid++,d=r.parent(),h=e||"x",u="x"===h?r.prevAll(":visible:first"):r.nextAll(":visible:first"),p=$('<div class="resize"></div>'),f=!1,v=(d.width(),d.offset()),m=(v.left,v.top),g={x:{display:"block",currentPos:d.offset().left,multiplier:1,cssProp:"left",otherCssProp:"right",size:d.width(),sizeProp:"width",moveProp:"pageX",init:{top:0,bottom:0,width:8,"margin-left":"-4px",height:"100%",left:"auto",right:"auto",opacity:0,position:"absolute",cursor:"ew-resize","border-left":"1px solid rgba(218, 218, 218, 0.5)","z-index":99999}},y:{display:"block",currentPos:d.offset().top,multiplier:-1,size:d.height(),cssProp:"bottom",otherCssProp:"top",sizeProp:"height",moveProp:"pageY",init:{top:"auto",cursor:"ns-resize",bottom:"auto",height:8,width:"100%",left:0,right:0,opacity:0,position:"absolute",border:0,"z-index":99999}}},b=i[c]||{},_={down:{x:null,y:null},delta:{x:null,y:null},track:!1,timer:null};p.bind("mousedown",function(e){_.down.x=e.pageX,_.down.y=e.pageY,_.delta={x:null,y:null},_.target=.25*p["x"==h?"height":"width"]()}),t.bind("mousemove",function(e){f&&(_.delta.x=_.down.x-e.pageX,_.delta.y=_.down.y-e.pageY,clearTimeout(_.timer),_.timer=setTimeout(function(){_.down.x=e.pageX,_.down.y=e.pageY},250))}),t.bind("mouseup touchend",function(){f&&(f=!1,p.trigger("resize-end"),o.remove(),s.removeClass("dragging"))}).bind("mousemove touchmove",function(e){f&&n(e[g[h].moveProp]||e.originalEvent.touches[0][g[h].moveProp])}),o.bind("mousemove touchmove",function(e){f&&n(e[g[h].moveProp]||e.originalEvent.touches[0][g[h].moveProp])}),p.bind("mousedown touchstart",function(e){f=!0,p.trigger("resize-start"),s.append(o).addClass("dragging"),g[h].size=d[g[h].sizeProp](),g[h].currentPos=0,a(),e.preventDefault()}),p.bind("fullsize",function(e,t){void 0===t&&(t="prev");var o=0;"prev"===t&&(o=100),r.css(g[h].cssProp,o+"%"),u.css(g[h].otherCssProp,100-o+"%"),p.hide()}),p.bind("init",function(e,t){p.css(g[h].init),g[h].size=d[g[h].sizeProp](),a(),m=d.offset().top,o.css("cursor","x"==h?"ew-resize":"ns-resize"),"y"==h?(r.css("border-right",0),u.css("border-left",0),u.css("border-top","2px solid #ccc")):r.css("border-top",0),r.is(":hidden")?p.hide():(u.length?r.css("border-"+g[h].cssProp,"1px solid #ccc"):r.css("border-"+g[h].cssProp,"0"),n(void 0!==t?t:b[h]||r.offset()[g[h].cssProp]))}),p.bind("change",function(e,t,o){r.css(g[h].cssProp,"0"),u.css(g[h].otherCssProp,"0"),r.css("border-"+g[h].cssProp,"0"),"y"===t?(r=r.find("> *"),p.appendTo(u),r.appendTo(u),u.css("height","100%"),l.hide(),p.css("margin-left",0),p.css("margin-top",5),p.addClass("vertical"),delete b.x,l.nextAll(":visible:first").trigger("init")):(r=u,u=s,r.appendTo(l),p.insertBefore(l),p.removeClass("vertical"),r.css("border-top",0),r=l,l.show(),p.css("margin-top",0),p.css("margin-left",-4),delete b.y,setTimeout(function(){l.nextAll(":visible:first").trigger("init")},0)),a(),h=t;var s=r;if(r=u,u=s,r.css(g[h].otherCssProp,"0"),u.css(g[h].cssProp,"0"),r.is(":visible")){if("y"===h){var i=r.find(".resize");i.each(function(e){var t=$(this);this===p[0]||t.trigger("init",100/(i-e-1))})}p.trigger("init",o||r.offset()[g[h].cssProp]||g[h].size/2)}}),u.css("width","auto"),u.css("height","auto"),r.data("splitter",p),r.before(p)})},$.fn.splitter.guid=0}]);
//# sourceMappingURL=debug.min.js.map